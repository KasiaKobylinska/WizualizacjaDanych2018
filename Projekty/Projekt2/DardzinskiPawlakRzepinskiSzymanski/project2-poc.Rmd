---
title: "project2-poc"
author: "Ryszard Szyma≈Ñski"
date: "May 21, 2019"
output:
  ioslides_presentation:
    widescreen: true
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE)
library(magrittr)
library(dplyr)
library(tidyverse)
library(viridis)
library(patchwork)
library(tidyverse)
library(hrbrthemes)
source("./builder.R")
```

## Shiny Presentation

This R Markdown presentation is made interactive using Shiny. The viewers of the presentation can change the assumptions underlying what's presented and see the results immediately. 

To learn more, see [Interactive Documents](http://rmarkdown.rstudio.com/authoring_shiny.html).

## Pie chart madness

```{r echo=FALSE}
pie_chart <- ggplot(mtcars, aes(x = "", y = cyl, fill = cyl)) +
  geom_bar(stat="identity") +
  coord_polar("y", start=0)

bar_chart <- ggplot(mtcars, aes(x=cyl, fill=cyl)) +
  geom_bar()

builder <- create_visualization_case_builder() %>% 
  add_good_plot(bar_chart) %>% 
  add_bad_plot(pie_chart) %>% 
  add_qa_case("What is the value for xxx?", 30) %>% 
  add_qa_case("What is the value for yyy?", 60) %>% 
  add_qa_case("What is the value for zzz?", 30) %>% 
  add_qa_case("What is the value for aaa?", 60)

app <- build(builder)
shinyApp(app$ui, app$server)
```

## Pie char madness returns

```{r echo=FALSE}
pie_chart <- ggplot(mtcars, aes(x = "", y = cyl, fill = cyl)) +
  geom_bar(stat="identity") +
  coord_polar("y", start=0)

bar_chart <- ggplot(mtcars, aes(x=cyl, fill=cyl)) +
  geom_bar()

builder <- create_visualization_case_builder() %>% 
  add_good_plot(bar_chart) %>% 
  add_bad_plot(pie_chart) %>% 
  add_qa_case("What is the value for xxx?", 30) %>% 
  add_qa_case("What is the value for aaa?", 60)

app <- build(builder)
shinyApp(app$ui, app$server)
```

## Order - so simple, so brilliant

```{r echo=FALSE}
df = data.frame(head(USArrests, 10))
df = df %>% mutate(names = rownames(df))

unordered = ggplot(df, aes(x=names , y =Assault )) +
  geom_bar(stat = 'identity') +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  xlab("State") +
  ylab("Assaults")



ordered =  
  ggplot(df, aes(x=reorder(names, -Assault) , y=Assault )) +
  geom_bar(stat = 'identity') +
  geom_text(aes(label=Assault), vjust= -0.2) +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
  xlab("State") +
  ylab("Assaults") 
  

builder <- create_visualization_case_builder() %>% 
  add_good_plot(ordered) %>% 
  add_bad_plot(unordered) %>% 
  add_qa_case("What is the value Alaska?", 263) %>% 
  add_qa_case("What State has more assaults: Colorado or Georgia?", "Georgia") %>% 
  add_qa_case("What is the difference?", 7)

app <- build(builder)
shinyApp(app$ui, app$server)
```

## Fancy Radial barplots

```{r echo=FALSE}


df = data.frame(head(USArrests, 5))
df = df %>% mutate(names = rownames(df))

bad = df %>%
      arrange(UrbanPop) %>%
      mutate(names=factor(names, names)) %>%
      ggplot( aes(x=names, y=UrbanPop) ) +
      geom_bar(stat="identity") +
      geom_text(hjust = 1, size = 3, aes(y = 0, label = paste(names," "))) +
      theme_ipsum() +
      theme(
        panel.grid.minor.y = element_blank(),
        panel.grid.major.y = element_blank(),
        legend.position="none",
        axis.text = element_blank()
      ) +
      ylab("") +
      xlab("") +
      coord_polar(theta = "y") +
      ylim(0,100) 

good1 =  ggplot(df, aes(x=reorder(names, -UrbanPop) , y=UrbanPop )) +
      geom_bar(stat = 'identity') +
      geom_text(aes(label=UrbanPop), vjust= -0.2) +
      theme(axis.text.x = element_text(angle = 60, vjust = 0.5)) +
      xlab("State") +
      ylab("Urban Population")

good2 = df %>%
        arrange(UrbanPop) %>%
        mutate(names=factor(names, names)) %>%
          ggplot( aes(x=names, y=UrbanPop) ) +
            ggtitle("Percent of Urban Population") +
            geom_segment( aes(x=names ,xend=names, y=0, yend=UrbanPop), color="grey") +
            geom_point(size=3) + #color="#69b3a2") +
            geom_text(aes(label=UrbanPop), vjust= -0.3, hjust= 1.3) +
            coord_flip() +
            ylim(0, 100) +
            theme_ipsum() +
            theme(
              panel.grid.minor.y = element_blank(),
              panel.grid.major.y = element_blank(),
              legend.position="none"
            ) +
            ylab("") +
            xlab("") 

builder <- create_visualization_case_builder() %>% 
  add_good_plot(good1) %>% 
  add_good_plot(good2) %>% 
  add_bad_plot(bad) %>% 
  add_qa_case("What is the difference between Arkansas and Alaska?", 2) %>% 
  add_qa_case("What is the value for Arizona?", 80) %>% 
  add_qa_case("What is the value for California?", 91)

app <- build(builder)
shinyApp(app$ui, app$server)
```


## Fancy Circular barplots

```{r echo=FALSE}


df = data.frame(tail(USArrests, 10))
df = df %>% mutate(names = rownames(df))
df$id=seq(1, to=nrow(df))

label_df=df
number_of_bar=nrow(label_df)
angle= 90 - 360 * (label_df$id-0.5) /number_of_bar     
label_df$hjust<-ifelse( angle < -90, 1, 0)
label_df$angle<-ifelse(angle < -90, angle+180, angle)

bad = ggplot(df, aes(x=as.factor(id), y=UrbanPop)) +  
        geom_bar(stat="identity", alpha=0.5) +
        scale_fill_viridis(discrete=TRUE) +
        ylim(-5,100) +
        theme_minimal() +
        theme(
          legend.position = "none",
          axis.text = element_blank(),
          axis.title = element_blank(),
          panel.grid = element_blank(),
          plot.margin = unit(rep(-1,4), "cm") 
        ) +
        coord_polar() + 
        geom_text(data=label_df, 
              aes(x=id, y=UrbanPop+10, label=names, hjust=hjust),
              color="black", 
              fontface="bold",
              alpha=0.6, 
              size=2.5,
              angle= label_df$angle, 
              inherit.aes = FALSE ) 

good = ggplot(df, aes(x=as.factor(id), y=UrbanPop)) +  
        geom_bar(stat="identity", alpha=0.5) +
        scale_fill_viridis(discrete=TRUE) +
        ylim(-80,100) +
        theme_minimal() +
        theme(
          legend.position = "none",
          axis.text = element_blank(),
          axis.title = element_blank(),
          panel.grid = element_blank(),
          plot.margin = unit(rep(-2,4), "cm") 
        ) +
        coord_polar() + 
        geom_text(data=label_df, 
                  aes(x=id, y=UrbanPop+10, label=paste(names, UrbanPop, sep=" "), hjust=hjust),
                  color="black", 
                  fontface="bold",
                  alpha=0.6, 
                  size=2.5,
                  angle= label_df$angle, 
                  inherit.aes = FALSE ) 

builder <- create_visualization_case_builder() %>% 
  add_good_plot(good) %>% 
  add_bad_plot(bad) %>% 
  add_qa_case("How many times is Virginia greater than Vermont?", 2) %>% 
  add_qa_case("If Utah Value is 80, what is the value for Washington?", 73) %>% 
  add_qa_case("Is Texas Value equal with Utah?", "Yes")

app <- build(builder)
shinyApp(app$ui, app$server)
```